<%namespace name='static' file='../static_content.html'/>
<%!
from datetime import datetime
from pytz import timezone, utc

from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
%>

<%inherit file="../main.html" />
<%block name="headextra">
  ## OG (Open Graph) title and description added below to give social media info to display
  ## (https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content#tags)
  <meta property="og:title" content="${program.name}" />
  <meta property="og:description" content="${program.short_description}" />
  
  
  <link rel="stylesheet" type="text/css" href="${static.url('css/program_info.css')}">
 
</%block>
<style type="text/css">
.pie-title-center 
{
  display: inline-block;
  position: relative;
  text-align: center;
  margin-left: 10px;
}

.pie-value
{
  display: block;
  position: absolute;
  font-size: 14px;
  height: 40px;
  top: 50%;
  left: 0;
  right: 0;
  margin-top: -22px;
  line-height: 40px;
}
canvas {
  height: 35px!important;
}
</style>
<%block name="js_extra">
  <!--
   <script src="${static.url('js/course_info.js')}"></script> 
  -->
</%block>

<%block name="pagetitle">${program.name}</%block>

<%
    total_courses = len(program.courses.select_related())
    c_progress = 0
%>

<main id="main" aria-label="Content" tabindex="-1">
  <div id="wrapper">
    <div class="courseware-container">
      <div class="course_title">
        <h1>${program.name}</h1>
      </div>
      <div class="heading-bar">
        <ul id="tabSet" class="scroll_tabs_theme_dark">
        </ul>
      </div>

      <div class="left-block" id="${program.name}_${program.id}">
        <div class="blocks">
          <h6>${program.name}</h6>
            <div class="listing">
              <ul>
                  % for index, course in enumerate(program_courses):
                  <%
                    c_progress += course_grades.get(course.id).get('points', 0.0)
                    if course.start:
                        started = datetime.now(utc) > course.start
                    else:
                        started = False
                    user_progress = course_grades.get(course.id).get('points', 0.0)
                    user_progress = int(user_progress) if user_progress ==100.0 else user_progress
                  %> 
                  <li id="${course.id}" class="lighttext">
                      <div class="type_icon">
                        <!-- <i class="fa fa-file" aria-hidden="true"></i> -->
                      </div>

                        % if course_grades.get(course.id)['course_states']['completed']:
                          <div class="dot-icon"><p>
                          ${user_progress} % completed</p></div>
                        % elif course_grades.get(course.id)['course_states']['in_progress']:
                          <div class="dot-icon"><p>${user_progress} % completed
                          </p></div>
                        % else:
                          % if started:
                            <div class="dot-icon">No progress yet.</div>
                          % else:
                            <div class="dot-icon">Not startrd yet.</div>
                          % endif
                        % endif

                        % if started:
                          <a href="${reverse('info', args=[unicode(course.id)])}">${course.display_name}</a>
                        % else:
                          ${course.display_name}
                        % endif
                  </li>
                  % endfor
                </ul>
            </div>
        </div>
      </div>


      <div class="right-block">
        <div class="blocks-right">
          <%
            if c_progress:
              c_progress = c_progress / total_courses
          %>
          <h4 style="float: left;">Program Average Progress:</h4>
          <div id="demo-pie-1" class="pie-title-center" data-percent="${c_progress}"> 
            <span class="pie-value"></span> 
          </div>
          <div class="course-block">
            <ul>
                <li><em class="fa fa-calendar"></em> Starts: <span>${program.start}</span></li>
                % if program.subject.name:
                  <li><em class="fa fa-graduation-cap fa-lg"></em> Subject: <span>${program.subject.name}</span></li>
                % endif
                <li><em class="fa fa-university fa-lg"></em> Institution: <span>${program.institution.name}</span></li>
                <li><em class="fa fa-book fa-lg"></em> Number Of Courses: <span>${len(program.courses.select_related())}</span></li>
            </ul>
          </div>
        </div>
      </div>
  </div>
</main>

<script type="text/javascript">
    $(document).ready(function () {
        $('#demo-pie-1').pieChart({
            barColor: '#68b828',
            trackColor: '#eee',
            lineCap: 'round',
            lineWidth: 8,
            onStep: function (from, to, percent) {
                $(this.element).find('.pie-value').text(Math.round(percent) + '%');
            }
        });
    });
</script>

<script type="text/javascript" src="${static.url('js/pie-chart.js')}"></script>